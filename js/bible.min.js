!function(e){var B={conf:{ToolTip:{width:300,height:150,timeout:10,hideTime:.3},Translate:"rus",Target:"blank",Site:"bibleonline.ru",CSS:"//api.bibleonline.ru/ref/style.css",ToolTipUse:!0,VSeparator:":.",RSeparator:",",CSeparator:";",BibleClass:"bibleref",NoBibleClass:"nobibleref",NoTags:["h1","h2","h3","h4","h5","h6"]},xcpt:{A:!0,APPLET:!0,BODY:!0,HEAD:!0,HR:!0,IMG:!0,INPUT:!0,META:!0,OPTION:!0,SCRIPT:!0,SELECT:!0,TEXTAREA:!0},init:function(){if(B.conf.NoTags)for(var e=B.conf.NoTags,t=0;t<e.length;t++)B.xcpt[e[t].toUpperCase()]=!0;B.loadStyle();for(var i,n,l=0,o="[\\-\\–\\—\\―]",s=(new RegExp(o,"g"),"\\s*["+B.conf.VSeparator.replace(/\s/g,"").replace(/\./g,"\\.")+"]\\s*"),a=(new RegExp(s,"g"),"\\s*["+B.conf.RSeparator.replace(/\s/g,"").replace(/\./g,"\\.")+"]\\s*"),r=(new RegExp(a,"g"),"\\s*["+B.conf.CSeparator.replace(/\s/g,"").replace(/\./g,"\\.")+"]\\s*"),d=(new RegExp(r,"g"),"(?:[1-9][0-9]?|1[0-4][0-9]|15[01])"),u="(?:[1-9][0-9]?|1[0-6][0-9]|17[0-6])",h="(?:"+o+"?(?:а?я|о?е|ь[ея]))?\\s*",m="(?![1234]"+h+"\\s*[а-яa-z])(?:"+d+"(?:\\s*(?:"+o+"|"+a+")\\s*"+d+")?)(?:"+s+u+"(?:(?:(?:"+o+"|"+a+")"+u+")*|(?:"+o+d+s+u+"))?)?",p=new RegExp("(\\W|^)(?:Б(?:ы?т|ытие)|G(?:e(?:n(?:esis)?)?)|Исх(?:од)?|Ex(?:d|od(?:us)?)|Л(?:е?в|евит)|L(?:ev(?:i(?:t(?:icus)?)?)?)|Ч(?:и?с|исла?|исел)|N(?:umb(?:ers?)?)|В(?:т(?:рзк)?|тор(?:озаконие)?)|D(?:eut?|euteron|(?:eu|ue)teronomy)|Иис(?:уса?)?|Нав(?:ина?)?|Иис(?:уса?)?\\.?\\s*Нав(?:ина?)?|J(?:o?sh?|oshua)|С(?:у?д|уд(?:ьи|ей))|J(?:u?dgs?|ud?ges?)|Руфь?|R(?:u?th)|Е(?:зд?|здра?)|Ezra?|Н(?:м|еем(?:ия)?)|N(?:eh(?:em(?:iah)?)?)|[ЕЭ](?:сф?|сфирь)|E(?:s(?:t(?:h(?:er)?)?)?)|Ио?в|Job|П(?:сл?|сал(?:т(?:ирь)?|ом|мы)?)|P(?:s(?:l?m|s|a(?:l(?:ms?)?)?)?)|П(?:р(?:ит(?:ч[иа]?)?)?)|P(?:r(?:[ov]|vbs|ov(?:erbs?)?)?)|Е(?:к(?:кл?|кле[сз]иаст)?)|Э(?:ккл(?:е[зc]иаст)?)|Проповедника?|E(?:c[cl]?l?|cclesia(?:ste)?|cc?lesiastes)|Q(?:oh(?:eleth)?)|П(?:(?:е?(сн|[сн])[яьи\\.])(?:\\s*Песней)?)?|S(?:ng|OS)|S(?:on(?:gs?)?)|Sol(?:omon)?|Song\\sof\\sSo(?:l|lomon|ngs)|Song?\\sof|Canticle(?:s|\\sof\\sCanticles)|И(?:с(?:а(?:[ий]я)?)?)|Is(?:a(?:[hi]|iah)?)|Иер(?:ем(?:ия)?)?|J(?:er(?:m(?:(?:ia|ai)h)?)?)|Пл(?:а?ч|[\\.\\s]Иер|ач\\sИеремии)|L(?:am(?:ent(?:ations?)?)?)|И(?:ез|езек(?:ииль)?)|Ez(?:[ke]?|ek(?:iel))|Д(?:ан(?:иил)?|нл?)|D(?:an(?:iel)?)|Ос(?:ия)?|H(?:os(?:ea)?)|И(?:л|оиль?)|J(?:l|oel?)|Ам(?:о?с)?|Am(?:[os]|os)|Авд(?:ий)|Ob(?:[ad]|ad(?:(?:ia|aia?)h)?)|Иона?|J(?:nh|on(?:ah?)?)|М(?:x|их(?:ей))|Mic(?:ah?)?|Наум|Nah(?:um)?|Авв(?:ак(?:ум)?)?|H(?:bk|ab(?:ak|b?akk?uk)?)|Соф(?:он(?:ия)?)?|Zep(?:h(?:aniah)?)?|Агг(?:ей)|Hag(?:g(?:ai|ia)?|ai|)?|З(?:хр|ах(?:ар(?:ия)?)?)|Zec(?:h(?:ara?iah)?)?|М(?:лх|ал(?:ах(?:ия)?)?)|Mal(?:achi)|Matt?(?:hew)?|Ma?rk|Ma[rt]|Luke?|J(?:no|hn|ohn?)|Дея(?:н(?:и[ея])?)?|Д\\.?А|Acts?|Деяни[яе]\\s(?:Св(?:ятых|\\.)?\\s)?Апостолов|И(а?к|акова?)|Ja(?:[ms]|ms|mes?)|И(?:д|уд[аы])|Jude?|Rom(?:ans?)?|Gal(?:at(?:ians?|ions)?)?|Eph(?:s|e(?:s(?:ians?)?)?)?|Ph[iplm]|Phil(?:lipp?ians|ipp?(?:ians)?)?|Col(?:os(?:sians?|ians)?)?|Tit(?:us)?|Phlm|Phil(?:lemon|e(?:m(?:on)?)?)?|Heb(?:r(?:e(?:ws?)?)?)?|Отк(?:р(?:\\.?Ин|ов(?:ен(?:\\.\\s*(?:Ин|иоанна)|И[не])(?:\\sот\\sИоанна|Иоанна(?:\\sБогослова)?)?)?)?)?|Rev(?:elations?)?|Apoc(?:alypse)?|(?:Посл(?:ание|\\.)\\s)?(к\\s)?(?:Рим(?:л(?:янам)?)?|Гал(?:ат(?:ам)?)?|[ЕЭ]ф(?:ес(?:янам)?)?|Фл[пм]|Фил(?:ип(?:пийцам)?)?|Кол(?:ос(?:сянам)?)?|Титу?|Филимону?|Евр(?:еям)?)|(?:Св(?:ятое|\\.)?\\s)?(Ев(?:ангелие|\\.)?\\s)?(?:от\\s)?(М[крфт]|Ма[тр]|Мтф|Мрк|матф(?:е[яй])?|Марка?|Лук[aи]?|Лк|Ин|Иоан(?:н[ау]?)?)|(?:(?:2|ii|[i1])\\s*|(?:1[\\-\\–\\—\\―]?(?:а?я|о?е)|Перв(?:ая|ое|\\.)|2[\\-\\–\\—\\―]?(?:а?я|о?е)|Втор(?:ая|ое|\\.))\\s)(?:(?:к|Посл(?:ание|\\.)?(?:\\sк)?|Кн(?:ига|\\.)?)\\s)?(?:Царей|Ца?р|Ц|Царств|Сам|Самуила?|Паралипоменон|Пар|Пр|Хр|Хрон|Хроник|Лет|Летопись|Фесс?|Фессалоникийцам|Сол|Солунянам|Тим|Тимоф|Тимофею|Кор|Коринф|Коринфян|Коринфянам|Иоан|Ин|Иоанн[уа]?|Пет|Птр?|Петра?)|(?:(?:3|iii)\\s*|(?:3[\\-\\–\\—\\―]?ь?[яе]\\s|Трет(?:ья|\\.)\\s))(?:(?:к|Посл(?:ание|\\.)?(?:\\sк)?|Кн(?:ига|\\.)?)\\s)?(?:Цар|Цр?|Царств|Ин|Иоанн?|Иоанн[ау])|(?:(?:4|iv)\\s*|4[\\-\\–\\—\\―]?а?я\\s*|Четверт(?:ая|\\.)\\s)(Кн(?:ига|.)?\\s)?(?:Цар|Цр?|Царств)|(?:(?:2|ii|[1i])\\s*|(?:First|Frst|Fst|1[\\-\\–\\—\\―]?st|Second|Scnd|Sec|S[ec]|2[\\-\\–\\—\\―]?nd)\\s)(?:[PKJS]|J[no]|P[et]|S[am]|Sam|Sml|Samuel|K[ings]|Kgs|Ki?ng|Kings|C[oh]|Chr?s|Chro?|Chroni?|Chronicl?|Chronicles?|T[imh]|Pete?r|Pete?|Ptr|Jhn|Jno|John?|Cori?|Corin|Corinth|Corinthi|Corinthian|Corinthians|Corth|Cortn|Thess?|Thessal|Thessalonians|Thessalonions|Tim|Timothy|Timoth)|A[cm]|C[lsl]|D[aenut]|E[codp]|G[an]|H[bekosg]|I[s]|J[damnbegru]?|L[amevuk]|M[ilrkta]|N[aeumb]|O[b]|P[hprsm]|R[moevuth]|S[gso]|T[it]|Q[o]|Z[ecp])\\.?"+("(\\s*(?![1234]"+h+"\\s*[а-яa-z])"+m+"(?:"+r+m+")*)")+"(?![\\d:а-я]|"+o+"[^\\d]+)(?![^<]*<\\/a>)","gi"),b=[document.body],T=new RegExp("(?:^|\\s)"+B.conf.BibleClass+"(?:\\s|$)","i"),f=new RegExp("(?:^|\\s)"+B.conf.NoBibleClass+"(?:\\s|$)","i"),g=p;i=b.pop();)if(3===i.nodeType){i.nodeValue.match(g);var v=i.parentNode;if(v&&0<v.className.length&&v.className.match(T)&&0<v.title.length&&v.title.match(g))E=v.title.match(g),n=0,elR=i.nodeValue,lnk=E[0],/^[^a-zа-я\.]$/i.test(lnk.substr(0,1))&&(lnk=lnk.substr(1,lnk.length-1)),bble=B.bblLink(lnk,elR,++l),i.nodeValue="",i===v.lastChild?v.appendChild(bble):v.insertBefore(bble,lnk),i=lnk;else if(E=i.nodeValue.match(g))for(n=0,t=E.length;n<t;n++)elR=i.nodeValue,lnk=E[n],/^[^a-zа-я0-9\.]$/i.test(lnk.substr(0,1))&&(lnk=lnk.substr(1,lnk.length-1)),c=elR.indexOf(lnk),bble=B.bblLink(lnk,lnk,++l),i.nodeValue=elR.replace(lnk,""),lnk=i.splitText(c),i===v.lastChild?v.appendChild(bble):v.insertBefore(bble,lnk),i=lnk}else if(i.firstChild){var E;for(n=0,t=(E=i.childNodes).length;n<t;n+=1)(3!==E[n].nodeType||""===i.nodeValue)&&(1!==E[n].nodeType||B.xcpt[E[n].tagName.toUpperCase()]||E[n].className&&E[n].className.length&&E[n].className.match(f))||b.push(E[n])}},bblLink:function(e,t,i){return bble=document.createElement("a"),bble.href="http://bble.ru/"+B.fixLink(lnk)+"?"+B.conf.Translate,bble.className="BibleOnlineBibleRef",bble.target=B.conf.Target,bble.id="BibleOnlineRef-"+i,bble.innerHTML=t,bble.setAttribute("text",lnk),B.conf.ToolTipUse&&(bble.addEventListener?(bble.addEventListener("mouseover",B.MouseOver,!1),bble.addEventListener("mouseout",B.MouseOut,!1)):(bble.attachEvent("onmouseover",B.MouseOver),bble.attachEvent("onmouseout",B.MouseOut))),bble},fixLink:function(e){var t=new RegExp("\\s*[\\-\\–\\—\\―]\\s*","g"),i="\\s*["+B.conf.VSeparator.replace(/\s/g,"").replace(/\./g,"\\.")+"]\\s*",n=new RegExp(i,"g"),l="\\s*["+B.conf.RSeparator.replace(/\s/g,"").replace(/\./g,"\\.")+"]\\s*",o=new RegExp(l,"g"),s="\\s*["+B.conf.CSeparator.replace(/\s/g,"").replace(/\./g,"\\.")+"]\\s*",a=new RegExp(s,"g");return e.replace(/\&nbsp\;/gi," ").replace(t,"-").replace(n,".").replace(o,",").replace(a,"$").replace(/\s+/g,"+")},MouseOut:function(e){var t=document.getElementById("BibleOnlineToolTip");t&&"visible"==t.style.visibility&&(clearTimeout(B.status.hideTimer),B.status.hideTimer=setTimeout(function(){t.style.visibility="hidden"},1e3*B.conf.ToolTip.hideTime))},MouseOver:function(e){var t=(e=e||wndow.event).target||e.srcElement;B.status.lastToolTip=[e,t],B.showToolTip(e,t)},showToolTip:function(e,t){var i=B.conf.ToolTip;clearTimeout(B.status.hideTimer);document.getElementById(t.id);var n=t.getAttribute("text")||t.innerHTML;if(B.marker[t.id]){if(0==(d=B.marker[t.id]).length||d.status&&"failed"==d.status){var l=document.getElementById("BibleOnlineToolTip");return clearTimeout(B.status.hideTimer),void(l.style.visibility="hidden")}if(l=document.getElementById("BibleOnlineToolTipContent")){l.innerHTML="",document.getElementById("BibleOnlineToolTip").style.visibility="visible",d.status&&"failed"==d.status&&(l.innerHTML='<div class="BibleOnlineRefLoader">К сожалению, загрузить отрывок не удалось</div>');for(var o="",s=0;s<d.length;s++)d[s].h2?(o=d[s].h2,l.innerHTML+="<h2>"+o+"</h2>"):d[s].v&&(l.innerHTML+=' <span><span class="verse-num">'+d[s].v.n+"&nbsp;</span>"+d[s].v.t+"</span>");document.getElementById("BibleOnlineToolTipMore").href="http://bble.ru/"+B.fixLink(n)+"?"+B.conf.Translate}}else{var a="//api.bibleonline.ru/ref/get/",r=B.fixLink(n).replace(/([^\+\,\;\$\.%a-z0-9]+)/gi,function(e,t){return encodeURIComponent(t)});a+=-1<a.indexOf("?")?"&callback=":"?callback=",a+="bibleRef.loaded",a+="&q="+r,a+="&marker="+t.id,a+="&trans="+B.conf.Translate;var d=document.getElementsByTagName("head")[0],u=document.createElement("script");u.setAttribute("id","script-"+t.id),u.setAttribute("src",a),u.setAttribute("charset","utf-8"),u.setAttribute("type","text/javascript"),setTimeout(function(){B.marker[t.id]||B.requestFailed(t.id)},1e3*B.conf.ToolTip.timeout),setTimeout(function(){B.showToolTip(e,t)},100),u.addEventListener?u.addEventListener("load",B.requestFinished(t.id),!1):u.attachEvent("onload",B.requestFinished(t.id)),document.getElementById("script-"+t.id)||d.appendChild(u),document.getElementById("BibleOnlineToolTip")||(c=document.createElement("div"),c.id="BibleOnlineToolTip",c.setAttribute("ref",t.id),c.className="BibleOnlineRefTooltip",c.style.position="absolute",c.style.visibility="hidden",c.style.overflow="auto",c.style.zIndex="999",c.style.width=i.width+"px",c.style.height=i.height+"px",c.innerHTML='<div class="BibleOnlineRefContent" id="BibleOnlineToolTipContent" ref="'+t.id+'"></div><div class="BibleOnlineRefFooter"><a target="'+B.conf.Target+'" class="BibleOnlineRefCopy" href="http://bibleonline.ru/">Библия Онлайн</a><a id="BibleOnlineToolTipMore" target="'+B.conf.Target+'" href="http://bble.ru/'+r+"?"+B.conf.Translate+'" class="BibleOnlineRefMore">в контексте &raquo;</a></div>',document.body.appendChild(c),c.onmouseover=function(){clearTimeout(B.status.hideTimer)},c.onmouseout=function(){var e=document.getElementById("BibleOnlineToolTip");e&&"visible"==e.style.visibility&&(clearTimeout(B.status.hideTimer),B.status.hideTimer=setTimeout(function(){e.style.visibility="hidden"},1e3*B.conf.ToolTip.hideTime))}),c=document.getElementById("BibleOnlineToolTipContent"),c.innerHTML='<div class="BibleOnlineRefLoader"><img width="220" height="19" src="//api.bibleonline.ru/img/ajax-loader.gif" alt="Loading..." /></div>'}if(c=document.getElementById("BibleOnlineToolTip")){var h=document.getElementById(t.id).getBoundingClientRect(),m=document.body,p=document.documentElement,b=window.pageYOffset||p.scrollTop||m.scrollTop,T=window.pageXOffset||p.scrollLeft||m.scrollLeft,f=p.clientTop||m.clientTop||0,g=p.clientLeft||m.clientLeft||0,v=0,E=0;window.innerWidth?v=window.innerWidth:p&&p.clientWidth?v=p.clientWidth:m&&m.clientWidth&&(v=m.clientWidth),window.innerHeight?E=window.innerHeight:p&&p.clientHeight?E=p.clientHeight:m&&m.clientHeight&&(E=m.clientHeight);var k=Math.round(h.bottom+b-f),y=Math.round(h.top+b-f),C=Math.round(h.left+T-g);C+i.width+40>=v&&(C=v-i.width-40),k+i.height+10>=E+b-f&&(k=2*y-k-i.height)<=10&&(k=10),c.style.left=C+"px",c.style.top=k+"px"}},marker:{},status:{hideTimer:null,lastToolTip:null},requestFailed:function(e){if(!B.marker[e]){B.removeScript(e),B.marker[e]={status:"failed"};var t=document.getElementById("BibleOnlineToolTipContent");t&&t.getAttribute("ref")==e&&(t.innerHTML='<div class="BibleOnlineRefLoader">К сожалению, загрузить отрывок не удалось</div>')}},removeScript:function(e){var t=document.getElementById("script-"+e);t&&t.parentNode.removeChild(t)},requestFinished:function(e){setTimeout(function(){B.marker[e]||B.requestFailed(e)},500)},loaded:function(e){B.marker[e.marker]=e.data,B.removeScript(e.marker),B.status.lastToolTip&&B.status.lastToolTip[1].id==e.marker&&B.showToolTip(B.status.lastToolTip[0],B.status.lastToolTip[1])},loadStyle:function(){if(B.conf.CSS&&0<B.conf.CSS.length){var e=document.getElementsByTagName("head")[0],t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=B.conf.CSS,e.insertBefore(t,e.firstChild)}},configure:function(e,t){B.conf[e]=t}};e.bibleRef={loaded:B.loaded,conf:B.configure},e.addEventListener?e.addEventListener("load",function(){B.init()},!1):e.attachEvent&&e.attachEvent("onload",function(){B.init()})}(window);